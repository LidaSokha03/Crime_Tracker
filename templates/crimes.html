<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Злочини</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='crimes.css') }}">
</head>
<body>
    <div class="header">
    <div class="logo-container">
        <h1 class="svidoc">SVI.DOC</h1>
    </div>
    <div class="filters">
        <a href="..." class="filter-btn">ГОЛОВНА</a>
        <a href="#" class="filter-btn" id="filter-button">ФІЛЬТРИ</a>
        <a href="..." class="filter-btn">СКИНУТИ</a>
    </div>
</div>
 
    <div class="content">
        <div class="crimes-grid">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% for category, message in messages %}
                    {% if category == 'danger' %}
                    <div class="input-error">
                        <span class="error-text">{{ message }}</span>
                    </div>
                    {% endif %}
                {% endfor %}
            {% endwith %}
            {% for crime in crimes %}
            <div class="crime-card">
                <div class="crime-content">
                    <div class="crime-info">
                        <div class="details-grid">
                            <div class="detail">
                                <strong>Дата:</strong>
                                <span>
                                    {% if crime.date.__class__.__name__ == 'datetime' %}
                                        {{ crime.date.strftime('%d.%m.%Y') }}
                                    {% else %}
                                        {{ crime.date }}
                                    {% endif %}
                                </span>
                            </div>
                            <div class="detail">
                                <strong>Область:</strong>
                                <span>{{ crime.region }}</span>
                            </div>
                            <div class="detail">
                                <strong>Населений пункт:</strong>
                                <span>{{ crime.location }}</span>
                            </div>
                            <div class="detail">
                                <strong>К-сть жертв:</strong>
                                <span>{{ crime.victims }}</span>
                            </div>
                            <div class="detail">
                                <strong>Інформація про жертви:</strong>
                                <span>{{ crime.vict_info }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="image-container">
                        {% if crime.image_url %}
                            <img src="{{ crime.image_url }}" alt="Crime image" class="crime-image">
                        {% else %}
                            <p style="color: red;">[Зображення відсутнє]</p>
                        {% endif %}
                    </div>
                </div>
                <p class="description">{{ crime.description }}</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="filters-modal">
        <div class="filters-modal-content">
            <div class="filters-modal-header">
                <h2>Фільтри</h2>
                <span class="filters-modal-close">&times;</span>
            </div>
            <form method="POST">
                <div class="filters-grid">
                    <div class="filter-section">
                        <h3>Період</h3>
                        <input type="date" name="date_from" value="{{ filters['date_from'] if filters['date_from'] else '' }}" class="date-input">
                        <input type="date" name="date_to" value="{{ filters['date_to'] if filters['date_to'] else '' }}" class="date-input">
                    </div>
                    <div class="filter-section">
                        <h3>Локація</h3>
                        <select name="region" class="filter-select">
                            <option value="" disabled selected>Область</option>
                            <option value="Автономна Республіка Крим" {% if filters['region'] == 'Автономна Республіка Крим' %}selected{% endif %}>Автономна Республіка Крим</option>
                            <option value="Вінницька" {% if filters['region'] == 'Вінницька' %}selected{% endif %}>Вінницька</option>
                            <!-- Інші області залишаються незмінними -->
                        </select>
                        <div class="input-with-button">
                            <input type="text" name="city" placeholder="Введіть назву населеного пункту" class="city-input">
                            <button type="submit" class="city-apply-btn">Шукати населений пункт</button>
                        </div>
                        <select name="location" class="filter-select">
                            <option value="">Оберіть населений пункт зі списку</option>
                            {% for city in cities %}
                            <option>{{ city }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="filter-section">
                        <h3>Зброя</h3>
                        <select name="weapon_type" class="filter-select">
                            <option value="" disabled selected>Оберіть зброю</option>
                            <option value="Шахед-136" {% if filters['weapon_type'] == 'Шахед-136' %}selected{% endif %}>Шахед-136</option>
                            <!-- Інші типи зброї залишаються незмінними -->
                        </select>
                    </div>
                </div>
                <button type="submit" name="apply_filters" value="true" class="filter-apply-btn">Застосувати фільтри</button>
            </form>
        </div>
    </div>

    <script>
        // Функціонал фільтрів
        const filterBtn = document.querySelector('#filter-button');
        const filtersModal = document.querySelector('.filters-modal');
        const filtersModalClose = document.querySelector('.filters-modal-close');

        filterBtn.addEventListener('click', (e) => {
            e.preventDefault();
            filtersModal.style.display = 'flex';
        });

        filtersModalClose.addEventListener('click', () => {
            filtersModal.style.display = 'none';
        });

        filtersModal.addEventListener('click', (event) => {
            if (event.target === filtersModal) {
                filtersModal.style.display = 'none';
            }
        });
        
        // Додаємо перевірку для кращої роботи на мобільних пристроях
        document.addEventListener('touchstart', function() {}, {passive: true});
        
        document.addEventListener('DOMContentLoaded', function () {
            {% if show_filters %}
                document.querySelector('.filters-modal').style.display = 'flex';
            {% endif %}
            
            // Адаптація висоти модального вікна для мобільних
            const adjustModalHeight = () => {
                const viewportHeight = window.innerHeight;
                const modalContent = document.querySelector('.filters-modal-content');
                if (modalContent) {
                    if (viewportHeight < 600) {
                        modalContent.style.maxHeight = '80vh';
                        modalContent.style.overflowY = 'auto';
                    } else {
                        modalContent.style.maxHeight = '';
                        modalContent.style.overflowY = '';
                    }
                }
            };
            
            window.addEventListener('resize', adjustModalHeight);
            adjustModalHeight();
        });
    </script>
</body>
</html>